<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø±Ø¬Ø§Øª - Ù…Ø­ÙˆÙ„ Excel Ø¥Ù„Ù‰ JSON</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .section {
            padding: 25px;
        }
        
        .hidden {
            display: none !important;
        }
        
        .converter-section {
            text-align: center;
            margin: 20px 0;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #3498db;
        }
        
        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn-success {
            background: var(--success-color);
        }
        
        .btn-warning {
            background: var(--warning-color);
        }
        
        input[type="file"] {
            margin: 15px 0;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            width: 100%;
            max-width: 400px;
        }
        
        .preview {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            max-height: 300px;
            overflow-y: auto;
            text-align: right;
            direction: ltr;
        }
        
        .json-output {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            text-align: left;
            direction: ltr;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”„ Ù…Ø­ÙˆÙ„ Excel Ø¥Ù„Ù‰ JSON</h1>
            <p>ØªØ­ÙˆÙŠÙ„ Ù…Ø¨Ø§Ø´Ø± Ù„Ù…Ù„ÙØ§Øª Excel Ø¥Ù„Ù‰ ØªÙ†Ø³ÙŠÙ‚ JSON</p>
        </div>

        <div class="section">
            <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø­ÙˆÙ„ -->
            <div class="converter-section">
                <h2>ğŸ“ Ø±ÙØ¹ Ù…Ù„Ù Excel</h2>
                <p>Ø§Ø®ØªØ± Ù…Ù„Ù Excel Ø§Ù„Ø°ÙŠ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</p>
                
                <input type="file" id="excelFile" accept=".xlsx, .xls">
                <br>
                
                <button class="btn btn-success" id="convertBtn">ğŸ”„ ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ JSON</button>
                <button class="btn btn-warning" id="downloadJsonBtn" disabled>ğŸ“¥ ØªØ­Ù…ÙŠÙ„ JSON</button>
                <button class="btn" id="useInAppBtn" disabled>ğŸš€ Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</button>
            </div>

            <!-- Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
            <div id="previewSection" class="hidden">
                <h3>ğŸ‘€ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                <div class="preview" id="dataPreview">
                    Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ù†Ø§...
                </div>
            </div>

            <!-- Ù†ØªÙŠØ¬Ø© JSON -->
            <div id="jsonSection" class="hidden">
                <h3>ğŸ“‹ Ù†ØªÙŠØ¬Ø© JSON</h3>
                <div class="json-output" id="jsonOutput">
                    Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ JSON Ù‡Ù†Ø§...
                </div>
            </div>

            <!-- Ù‚Ø³Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Ù…Ø®ÙÙŠ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©) -->
            <div id="appSection" class="hidden">
                <h2>ğŸ“ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</h2>
                <!-- Ù‡Ù†Ø§ Ø³ÙŠØªÙ… ÙˆØ¶Ø¹ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
            </div>
        </div>
    </div>

    <script>
        // ========== Ù…Ø­ÙˆÙ„ Excel Ø¥Ù„Ù‰ JSON ==========
        class ExcelToJsonConverter {
            constructor() {
                this.jsonData = null;
                this.excelData = null;
            }

            // ØªØ­ÙˆÙŠÙ„ Excel Ø¥Ù„Ù‰ JSON
            async convertExcelToJson(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    
                    reader.onload = (e) => {
                        try {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                            const excelData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                            
                            this.excelData = excelData;
                            this.jsonData = this.processExcelData(excelData);
                            
                            resolve(this.jsonData);
                            
                        } catch (error) {
                            reject(error);
                        }
                    };
                    
                    reader.onerror = () => reject(new Error('ÙØ´Ù„ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù'));
                    reader.readAsArrayBuffer(file);
                });
            }

            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨ÙŠØ§Ù†Ø§Øª Excel ÙˆØªØ­ÙˆÙŠÙ„Ù‡Ø§ Ø¥Ù„Ù‰ JSON
            processExcelData(excelData) {
                if (!excelData || excelData.length < 2) {
                    throw new Error('Ø§Ù„Ù…Ù„Ù Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©');
                }

                const headers = excelData[0];
                const jsonData = [];
                
                console.log('ğŸ” Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©:', headers);

                for (let i = 1; i < excelData.length; i++) {
                    const row = excelData[i];
                    if (row.length === 0) continue;

                    const item = {};
                    
                    // ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
                    headers.forEach((header, index) => {
                        if (header && row[index] !== undefined) {
                            // ØªÙ†Ø¸ÙŠÙ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙˆØ¯
                            const cleanHeader = header.toString().trim();
                            item[cleanHeader] = this.cleanValue(row[index]);
                        }
                    });

                    jsonData.push(item);
                }

                return jsonData;
            }

            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù‚ÙŠÙ…
            cleanValue(value) {
                if (value === null || value === undefined) return '';
                if (typeof value === 'number') return value;
                return value.toString().trim();
            }

            // ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù JSON
            downloadJson(filename = 'students.json') {
                if (!this.jsonData) return false;
                
                const jsonString = JSON.stringify(this.jsonData, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                
                URL.revokeObjectURL(url);
                return true;
            }

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            getDataPreview() {
                if (!this.jsonData || this.jsonData.length === 0) {
                    return 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶';
                }

                let preview = `<strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ${this.jsonData.length}</strong><br><br>`;
                preview += '<strong>Ø§Ù„Ù‡ÙŠÙƒÙ„:</strong><br>';
                
                // Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 3 Ø³Ø¬Ù„Ø§Øª ÙƒÙ…Ø«Ø§Ù„
                const sampleRecords = this.jsonData.slice(0, 3);
                
                sampleRecords.forEach((record, index) => {
                    preview += `<strong>Ø§Ù„Ø³Ø¬Ù„ ${index + 1}:</strong><br>`;
                    Object.keys(record).forEach(key => {
                        preview += `  ${key}: ${record[key]}<br>`;
                    });
                    preview += '<br>';
                });

                return preview;
            }

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ JSON ÙƒÙ€ string
            getJsonString() {
                return JSON.stringify(this.jsonData, null, 2);
            }
        }

        // ========== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ==========
        const converter = new ExcelToJsonConverter();
        let currentJsonData = null;

        // Ø¹Ù†Ø§ØµØ± DOM
        const excelFileInput = document.getElementById('excelFile');
        const convertBtn = document.getElementById('convertBtn');
        const downloadJsonBtn = document.getElementById('downloadJsonBtn');
        const useInAppBtn = document.getElementById('useInAppBtn');
        const dataPreview = document.getElementById('dataPreview');
        const jsonOutput = document.getElementById('jsonOutput');
        const previewSection = document.getElementById('previewSection');
        const jsonSection = document.getElementById('jsonSection');
        const appSection = document.getElementById('appSection');

        // Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        convertBtn.addEventListener('click', handleConversion);
        downloadJsonBtn.addEventListener('click', handleDownload);
        useInAppBtn.addEventListener('click', handleUseInApp);

        async function handleConversion() {
            const file = excelFileInput.files[0];
            if (!file) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Excel Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }

            try {
                convertBtn.disabled = true;
                convertBtn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„...';
                
                await converter.convertExcelToJson(file);
                currentJsonData = converter.jsonData;
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
                dataPreview.innerHTML = converter.getDataPreview();
                previewSection.classList.remove('hidden');
                
                // Ø¹Ø±Ø¶ JSON
                jsonOutput.textContent = converter.getJsonString();
                jsonSection.classList.remove('hidden');
                
                // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
                downloadJsonBtn.disabled = false;
                useInAppBtn.disabled = false;
                
                convertBtn.textContent = 'âœ… ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„';
                
            } catch (error) {
                alert('âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„: ' + error.message);
                console.error('Conversion error:', error);
            } finally {
                convertBtn.disabled = false;
                convertBtn.textContent = 'ğŸ”„ ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ JSON';
            }
        }

        function handleDownload() {
            if (converter.downloadJson()) {
                alert('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù JSON Ø¨Ù†Ø¬Ø§Ø­');
            } else {
                alert('âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„');
            }
        }

        function handleUseInApp() {
            if (!currentJsonData) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…');
                return;
            }
            
            // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙˆÙ„Ø©
            startMainApplication(currentJsonData);
        }

        // ========== Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ==========
        function startMainApplication(studentsData) {
            // Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø§Ù„Ù…Ø­ÙˆÙ„
            document.querySelector('.converter-section').classList.add('hidden');
            previewSection.classList.add('hidden');
            jsonSection.classList.add('hidden');
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø³Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            appSection.classList.remove('hidden');
            
            // Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            createMainAppInterface(studentsData);
        }

        function createMainAppInterface(studentsData) {
            appSection.innerHTML = `
                <div style="text-align: center; margin: 20px 0;">
                    <h2>ğŸ“ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
                    <p>ØªÙ… ØªØ­Ù…ÙŠÙ„ ${studentsData.length} Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­</p>
                </div>

                <div style="text-align: center; margin: 20px 0;">
                    <input type="text" id="teacherIdInput" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø¹Ù„Ù…..." style="padding: 10px; margin: 10px; border: 2px solid #ddd; border-radius: 5px;">
                    <button class="btn btn-success" id="loginBtn">ğŸ” Ø¯Ø®ÙˆÙ„</button>
                </div>

                <div id="mainAppContent" class="hidden">
                    <!-- Ù‡Ù†Ø§ Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØ§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
                </div>

                <div id="appLoading" class="hidden" style="text-align: center; padding: 20px;">
                    â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
                </div>
            `;

            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
            document.getElementById('loginBtn').addEventListener('click', function() {
                const teacherId = document.getElementById('teacherIdInput').value.trim();
                if (!teacherId) {
                    alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø¹Ù„Ù…');
                    return;
                }
                
                loadTeacherData(teacherId, studentsData);
            });
        }

        function loadTeacherData(teacherId, allStudents) {
            const appLoading = document.getElementById('appLoading');
            const mainAppContent = document.getElementById('mainAppContent');
            
            appLoading.classList.remove('hidden');
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
            setTimeout(() => {
                // ØªØµÙÙŠØ© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù…
                const teacherStudents = allStudents.filter(student => 
                    student.Ø§Ù„Ù…Ø¹Ø±Ù === teacherId || student.Ø§Ù„Ù…Ø¹Ù„Ù… === teacherId
                );
                
                if (teacherStudents.length === 0) {
                    alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ù„Ù…');
                    appLoading.classList.add('hidden');
                    return;
                }
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                displayStudentsTable(teacherStudents, teacherId);
                appLoading.classList.add('hidden');
                mainAppContent.classList.remove('hidden');
                
            }, 1000);
        }

        function displayStudentsTable(students, teacherId) {
            const mainAppContent = document.getElementById('mainAppContent');
            
            let tableHTML = `
                <div style="margin: 20px 0;">
                    <h3>ğŸ‘¨â€ğŸ« Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø®Ø§ØµÙŠÙ† Ø¨Ø§Ù„Ù…Ø¹Ù„Ù…: ${teacherId}</h3>
                    <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨: ${students.length}</p>
                </div>
                
                <div style="overflow-x: auto;">
                    <table border="1" style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                        <thead>
                            <tr style="background: #34495e; color: white;">
            `;
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø¤ÙˆØ³ Ù…Ù† Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø£ÙˆÙ„Ù‰
            if (students.length > 0) {
                const firstStudent = students[0];
                Object.keys(firstStudent).forEach(key => {
                    tableHTML += `<th style="padding: 10px; text-align: right;">${key}</th>`;
                });
            }
            
            tableHTML += `</tr></thead><tbody>`;
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            students.forEach(student => {
                tableHTML += `<tr>`;
                Object.values(student).forEach(value => {
                    tableHTML += `<td style="padding: 8px; border: 1px solid #ddd; text-align: right;">${value}</td>`;
                });
                tableHTML += `</tr>`;
            });
            
            tableHTML += `</tbody></table></div>`;
            
            mainAppContent.innerHTML = tableHTML;
        }

        // Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
        console.log('ğŸš€ Ù…Ø­ÙˆÙ„ Excel Ø¥Ù„Ù‰ JSON Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…!');
    </script>
</body>
</html>